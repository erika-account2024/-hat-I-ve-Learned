## ７回講義の感想  
  
セキュリティーの重要性について学べた。今はまだ課題という名で重要なものを記載することも少ない。この先の仕事ととらえたときのことも考えながら、公開してもよいものは否かを確認しながら進めていく。  
  
## 課題を通してのセキュリティーについて  
  
|要因|課題中|対策|
|----|----|---- | 
|脆弱性|HTTP通信を使用|HTTPS通信に変更|  
|認証情報の流出|IAM使用|MFAで保護/権限の設定|  
|人為的な過負荷(DDoS攻撃)|AmazonShieldを使用|standardがすでに適用|  

* HTTP通信は平文のためのぞき見、改ざんがだれでも出来てしまう。そのためHTTPS通信にして暗号化する必要がある。  
* 認証情報は二重ロックMFAを使用したが、他にもgithubも使用しているためキーの情報を含めプッシュしないよう設定する。 


## HTTPSに変更  
1. ドメインの購入。  
Route53で購入。(値段が異なるので他と比較してみてください。)  
1年で2000円くらい。  
  
2. サブメインの設定。  
Route53に移動。購入したドメインを選択。  
ホストゾーンからfruits.app.ドメインで作成。  
Route53ではNSとSOAが確認できる。  
  
3. レコードの作成。  
タイプ：A-IPｖ４アドレスと一部のＡＷＳリソースにトラフィックをルーティング。  　
エイリアス：オン  
           ALBとCLBへのエイリアス。  
           ALBのあるリージョン。  
           使用したいALB。  
  
4. ACMで証明発行  
ACMに移動して、サブメイン(作ったもの)をリクエストする。  
DNS検証をクリックして待つ。  
Route53ではCNAMEが確認できる。  
  
5. リクエスト発行後  
リクエスト一覧から詳細を開いて、CNAMEを確認。  
その枠内にRoute53でDNS作成。  
  
6. DNS検証  
Route53で該当するホストゾーンに移動。  
ACMが指定しているCNAMEをレコードに追加する。
AWSに登録しているアドレスに承認用のURLが届くのでクリック。  
  
7. ステータスの確認。  
ACMに移動して、レコードが正しく設定されていればステータスが”発行済み”になる。 Route53ではAが確認できる。  

### AWS側の変更  
1. セキュリティーグループの変更。  
ALB用のインバウンドをHTTPSのMYPCのIPに変更。  

2. ALBのリスナーの変更。  
リスナーの設定をHTTPSに変更。  
ポート443。  
セキュアリスナーの変更。ACMから証明書を選択。  

3. healthチェック  
ターゲットグループからhealthチェックを行い異常がないか確認。  

4. アプリのconfigに追加。  
````
cd アプリ/config/environments  
vi development.rb  
````  
````
config.hosts << "サブメイン"
````
````
sudo systemctl restart puma
sudo systemctl restart nginx
````
5. ブラウザで確認。  
https://サブメイン


